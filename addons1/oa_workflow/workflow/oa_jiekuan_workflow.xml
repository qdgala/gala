<?xml version="1.0"?>
<openerp>
    <data noupdate="0">

        <!--定义工作流-->
        <record id="oa_jiekuan_workflow" model="workflow">
            <field name="name">借款申请</field>
            <field name="osv">oa.jiekuan</field>
            <field name="on_create">True</field>
        </record>

        <!--活动（Activity）定义-->
        <record id="activity_oa_jiekuan_sq" model="workflow.activity">
            <field name="wkf_id" ref="oa_jiekuan_workflow"/>
            <field name="flow_start">True</field>
            <field name="name">借款人申请</field>
            <field name="kind">function</field>
            <field name="action">wkf_change_and_notice('sq')</field>
        </record>
        <record id="activity_oa_jiekuan_bmsp" model="workflow.activity">
            <field name="wkf_id" ref="oa_jiekuan_workflow"/>
            <field name="name">部门领导审批</field>
            <field name="kind">function</field>
            <field name="action">wkf_change_and_notice('bmsp')</field>
        </record>
        <record id="activity_oa_jiekuan_fgfz" model="workflow.activity">
            <field name="wkf_id" ref="oa_jiekuan_workflow"/>
            <field name="name">分管副总审批</field>
            <field name="kind">function</field>
            <field name="action">wkf_change_and_notice('fgfz')</field>
        </record>
        <record id="activity_oa_jiekuan_cwsp" model="workflow.activity">
            <field name="wkf_id" ref="oa_jiekuan_workflow"/>
            <field name="name">财务领导审批</field>
            <field name="kind">function</field>
            <field name="action">wkf_change_and_notice('cwsp')</field>
        </record>
        <record id="activity_oa_jiekuan_zjl" model="workflow.activity">
            <field name="wkf_id" ref="oa_jiekuan_workflow"/>
            <field name="name">总经理</field>
            <field name="kind">function</field>
            <field name="action">wkf_change_and_notice('zjl')</field>
        </record>
        <record id="activity_oa_jiekuan_cnqr" model="workflow.activity">
            <field name="wkf_id" ref="oa_jiekuan_workflow"/>
            <field name="name">出纳确认</field>
            <field name="kind">function</field>
            <field name="action">wkf_change_and_notice('cnqr')</field>
        </record>
        <record id="activity_oa_jiekuan_lkrqr" model="workflow.activity">
            <field name="wkf_id" ref="oa_jiekuan_workflow"/>
            <field name="name">领款人确认</field>
            <field name="kind">function</field>
            <field name="action">wkf_change_and_notice('lkrqr')</field>
        </record>
        <record id="activity_oa_jiekuan_ok" model="workflow.activity">
            <field name="wkf_id" ref="oa_jiekuan_workflow"/>
            <field name="flow_stop">True</field>
            <field name="name">完成</field>
            <field name="kind">function</field>
            <field name="action">wkf_change_and_notice('ok')</field>
        </record>
        <record id="activity_oa_jiekuan_off" model="workflow.activity">
            <field name="wkf_id" ref="oa_jiekuan_workflow"/>
            <field name="flow_stop">True</field>
            <field name="name">关闭</field>
            <field name="kind">function</field>
            <field name="action">wkf_change_and_notice('off')</field>
        </record>

        <!--迁移（Transition）的定义-->
        <record id="trans_oa_jiekuan_sq_off" model="workflow.transition">
            <field name="act_from" ref="activity_oa_jiekuan_sq"/>
            <field name="act_to" ref="activity_oa_jiekuan_off"/>
            <field name="signal">sq_off</field>
            <field name="condition">is_user()</field>
        </record>
        <record id="trans_oa_jiekuan_sq_bmsp" model="workflow.transition">
            <field name="act_from" ref="activity_oa_jiekuan_sq"/>
            <field name="act_to" ref="activity_oa_jiekuan_bmsp"/>
            <field name="signal">sq_to</field>
            <field name="condition">is_user() and not emp_ls_is_fz and is_not_in(['oa_workflow.group_oa_department_manager','oa_workflow.group_oa_department_fz','oa_workflow.group_oa_department_cwb']) and not emp_is_cwb_user()</field>
        </record>
        <record id="trans_oa_jiekuan_sq_fgfz" model="workflow.transition">
            <field name="act_from" ref="activity_oa_jiekuan_sq"/>
            <field name="act_to" ref="activity_oa_jiekuan_fgfz"/>
            <field name="signal">sq_to</field>
            <field name="condition">is_user() and is_not_in(['oa_workflow.group_oa_department_fz','oa_workflow.group_oa_department_cwb'])</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_manager"/>
        </record>
        <record id="trans_oa_jiekuan_sq_fgfz2" model="workflow.transition">
            <field name="act_from" ref="activity_oa_jiekuan_sq"/>
            <field name="act_to" ref="activity_oa_jiekuan_fgfz"/>
            <field name="signal">sq_to</field>
            <field name="condition">is_user() and emp_ls_is_fz()</field>
        </record>
        <record id="trans_oa_jiekuan_sq_cwsp" model="workflow.transition">
            <field name="act_from" ref="activity_oa_jiekuan_sq"/>
            <field name="act_to" ref="activity_oa_jiekuan_cwsp"/>
            <field name="signal">sq_to</field>
            <field name="condition">is_user() and is_not_in(['oa_workflow.group_oa_department_cwb'])</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_fz"/>
        </record>
        <record id="trans_oa_jiekuan_sq_cwsp2" model="workflow.transition">
            <field name="act_from" ref="activity_oa_jiekuan_sq"/>
            <field name="act_to" ref="activity_oa_jiekuan_cwsp"/>
            <field name="signal">sq_to</field>
            <field name="condition">is_user() and emp_is_cwb_user() and not emp_is_cwb_manager()</field>
        </record>
        <record id="trans_oa_jiekuan_sq_zjl" model="workflow.transition">
            <field name="act_from" ref="activity_oa_jiekuan_sq"/>
            <field name="act_to" ref="activity_oa_jiekuan_zjl"/>
            <field name="signal">sq_to</field>
            <field name="condition">is_user()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_cwb"/>
        </record>
        <record id="trans_oa_jiekuan_sq_cnqr" model="workflow.transition">
            <field name="act_from" ref="activity_oa_jiekuan_sq"/>
            <field name="act_to" ref="activity_oa_jiekuan_cnqr"/>
            <field name="signal">sq_to</field>
            <field name="condition">is_user()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_boss"/>
        </record>

        <record id="trans_oa_jiekuan_bmsp_fgfz" model="workflow.transition">
            <field name="act_from" ref="activity_oa_jiekuan_bmsp"/>
            <field name="act_to" ref="activity_oa_jiekuan_fgfz"/>
            <field name="signal">bmsp_fgfz</field>
            <field name="condition">is_bmld()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_manager"/>
        </record>

        <record id="trans_oa_jiekuan_fgfz_cwsp" model="workflow.transition">
            <field name="act_from" ref="activity_oa_jiekuan_fgfz"/>
            <field name="act_to" ref="activity_oa_jiekuan_cwsp"/>
            <field name="condition">is_fz()</field>
            <field name="signal">fgfz_cwsp</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_fz"/>
        </record>

        <record id="trans_oa_jiekuan_cwsp_zjl" model="workflow.transition">
            <field name="act_from" ref="activity_oa_jiekuan_cwsp"/>
            <field name="act_to" ref="activity_oa_jiekuan_zjl"/>
            <field name="signal">cwsp_zjl</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_cwb"/>
        </record>

        <record id="trans_oa_jiekuan_zjl_cnqr" model="workflow.transition">
            <field name="act_from" ref="activity_oa_jiekuan_zjl"/>
            <field name="act_to" ref="activity_oa_jiekuan_cnqr"/>
            <field name="signal">zjl_cnqr</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_boss"/>
        </record>

        <record id="trans_oa_jiekuan_cnqr_lkrqr" model="workflow.transition">
            <field name="act_from" ref="activity_oa_jiekuan_cnqr"/>
            <field name="act_to" ref="activity_oa_jiekuan_lkrqr"/>
            <field name="signal">cnqr_lkrqr</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_cn"/>
        </record>

        <record id="trans_oa_jiekuan_lkrqr_ok" model="workflow.transition">
            <field name="act_from" ref="activity_oa_jiekuan_lkrqr"/>
            <field name="act_to" ref="activity_oa_jiekuan_ok"/>
            <field name="signal">lkrqr_ok</field>
            <field name="condition">is_user()</field>
        </record>

        <!--回退流程-->
        <record id="trans_oa_jiekuan_bm_sq" model="workflow.transition">
            <field name="act_from" ref="activity_oa_jiekuan_bmsp"/>
            <field name="act_to" ref="activity_oa_jiekuan_sq"/>
            <field name="signal">bm_sq</field>
            <field name="condition">is_bmld()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_manager"/>
        </record>
        <record id="trans_oa_jiekuan_fz_sq" model="workflow.transition">
            <field name="act_from" ref="activity_oa_jiekuan_fgfz"/>
            <field name="act_to" ref="activity_oa_jiekuan_sq"/>
            <field name="signal">fz_bm</field>
            <field name="condition">is_fz() and emp_is_child()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_fz"/>
        </record>
        <record id="trans_oa_jiekuan_fz_bm" model="workflow.transition">
            <field name="act_from" ref="activity_oa_jiekuan_fgfz"/>
            <field name="act_to" ref="activity_oa_jiekuan_bmsp"/>
            <field name="signal">fz_bm</field>
            <field name="condition">is_fz() and not emp_is_child()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_fz"/>
        </record>
        <record id="trans_oa_jiekuan_cw_fz" model="workflow.transition">
            <field name="act_from" ref="activity_oa_jiekuan_cwsp"/>
            <field name="act_to" ref="activity_oa_jiekuan_fgfz"/>
            <field name="signal">cw_fz</field>
            <field name="condition">not emp_is_cwb_user() and not emp_is_fz()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_cwb"/>
        </record>
        <record id="trans_oa_jiekuan_cw_sq" model="workflow.transition">
            <field name="act_from" ref="activity_oa_jiekuan_cwsp"/>
            <field name="act_to" ref="activity_oa_jiekuan_sq"/>
            <field name="signal">cw_fz</field>
            <field name="condition">emp_is_cwb_user() or emp_is_fz()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_cwb"/>
        </record>
        <record id="trans_oa_jiekuan_zjl_cw" model="workflow.transition">
            <field name="act_from" ref="activity_oa_jiekuan_zjl"/>
            <field name="act_to" ref="activity_oa_jiekuan_cwsp"/>
            <field name="signal">zjl_cw</field>
            <field name="condition">not emp_is_cwb_manager()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_boss"/>
        </record>
        <record id="trans_oa_jiekuan_zjl_sq" model="workflow.transition">
            <field name="act_from" ref="activity_oa_jiekuan_zjl"/>
            <field name="act_to" ref="activity_oa_jiekuan_sq"/>
            <field name="signal">zjl_cw</field>
            <field name="condition">emp_is_cwb_manager()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_boss"/>
        </record>


    </data>
</openerp>