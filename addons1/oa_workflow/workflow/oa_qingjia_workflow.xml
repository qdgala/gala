<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--定义工作流-->
    <record id="oa_qingjia_workflow" model="workflow">
        <field name="name">请假申请</field>
        <field name="osv">oa.qingjia</field>
        <field name="on_create">True</field>
    </record>

    <!--活动（Activity）定义-->
    <record id="activity_oa_qingjia_sq" model="workflow.activity">
        <field name="wkf_id" ref="oa_qingjia_workflow"/>
        <field name="flow_start">True</field>
        <field name="name">请假人申请</field>
        <field name="kind">function</field>
        <field name="action">wkf_change_and_notice('sq')</field>
    </record>
    <record id="activity_oa_qingjia_ldsp" model="workflow.activity">
        <field name="wkf_id" ref="oa_qingjia_workflow"/>
        <field name="name">上级领导审批</field>
        <field name="kind">function</field>
        <field name="action">wkf_change_and_notice('ldsp')</field>
    </record>
    <record id="activity_oa_qingjia_jlsp" model="workflow.activity">
        <field name="wkf_id" ref="oa_qingjia_workflow"/>
        <field name="name">经理审批</field>
        <field name="kind">function</field>
        <field name="action">wkf_change_and_notice('jlsp')</field>
    </record>
    <record id="activity_oa_qingjia_xzbqr" model="workflow.activity">
        <field name="wkf_id" ref="oa_qingjia_workflow"/>
        <field name="name">行政部确认</field>
        <field name="kind">function</field>
        <field name="action">wkf_change_and_notice('xzbqr')</field>
    </record>
    <record id="activity_oa_qingjia_ok" model="workflow.activity">
        <field name="wkf_id" ref="oa_qingjia_workflow"/>
        <field name="flow_stop">True</field>
        <field name="name">完成</field>
        <field name="kind">function</field>
        <field name="action">wkf_change_and_notice('ok')</field>
    </record>
    <record id="activity_oa_qingjia_off" model="workflow.activity">
        <field name="wkf_id" ref="oa_qingjia_workflow"/>
        <field name="flow_stop">True</field>
        <field name="name">关闭</field>
        <field name="kind">function</field>
        <field name="action">wkf_change_and_notice('off')</field>
    </record>

    <!--迁移（Transition）的定义-->
    <record id="trans_oa_qingjia_sq_off" model="workflow.transition">
        <field name="act_from" ref="activity_oa_qingjia_sq"/>
        <field name="act_to" ref="activity_oa_qingjia_off"/>
        <field name="signal">sq_off</field>
        <field name="condition">is_user()</field>
    </record>
    <record id="trans_oa_qingjia_sq_ldsp" model="workflow.transition">
        <field name="act_from" ref="activity_oa_qingjia_sq"/>
        <field name="act_to" ref="activity_oa_qingjia_ldsp"/>
        <field name="signal">sq_ldsp</field>
        <field name="condition">is_user() and is_not_in(['oa_workflow.group_oa_department_cwb'])</field>
    </record>
    <record id="trans_oa_qingjia_sq_jlsp" model="workflow.transition">
        <field name="act_from" ref="activity_oa_qingjia_sq"/>
        <field name="act_to" ref="activity_oa_qingjia_jlsp"/>
        <field name="signal">sq_ldsp</field>
        <field name="condition">is_user()</field>
        <field name="group_id" ref="oa_workflow.group_oa_department_cwb"/>
    </record>

    <record id="trans_oa_qingjia_ldsp_xzbqr" model="workflow.transition">
        <field name="act_from" ref="activity_oa_qingjia_ldsp"/>
        <field name="act_to" ref="activity_oa_qingjia_xzbqr"/>
        <field name="signal">ldsp_to</field>
        <field name="condition">is_ld() and not days_than_3()</field>
    </record>

    <record id="trans_oa_qingjia_ldsp_jlsp" model="workflow.transition">
        <field name="act_from" ref="activity_oa_qingjia_ldsp"/>
        <field name="act_to" ref="activity_oa_qingjia_jlsp"/>
        <field name="signal">ldsp_to</field>
        <field name="condition">is_ld() and days_than_3() and is_not_in(['oa_workflow.group_oa_department_fz','oa_workflow.group_oa_department_boss'])</field>
    </record>
    <record id="trans_oa_qingjia_ldsp_xzbqr_fz" model="workflow.transition">
        <field name="act_from" ref="activity_oa_qingjia_ldsp"/>
        <field name="act_to" ref="activity_oa_qingjia_xzbqr"/>
        <field name="signal">ldsp_to</field>
        <field name="group_id" ref="oa_workflow.group_oa_department_fz"/>
    </record>
    <record id="trans_oa_qingjia_ldsp_xzbqr_boss" model="workflow.transition">
        <field name="act_from" ref="activity_oa_qingjia_ldsp"/>
        <field name="act_to" ref="activity_oa_qingjia_xzbqr"/>
        <field name="signal">ldsp_to</field>
        <field name="group_id" ref="oa_workflow.group_oa_department_boss"/>
    </record>

    <record id="trans_oa_qingjia_jlsp_xzbqr" model="workflow.transition">
        <field name="act_from" ref="activity_oa_qingjia_jlsp"/>
        <field name="act_to" ref="activity_oa_qingjia_xzbqr"/>
        <field name="signal">jlsp_xzbqr</field>
        <field name="group_id" ref="oa_workflow.group_oa_department_fz"/>
    </record>
    <record id="trans_oa_qingjia_jlsp_xzbqr2" model="workflow.transition">
        <field name="act_from" ref="activity_oa_qingjia_jlsp"/>
        <field name="act_to" ref="activity_oa_qingjia_xzbqr"/>
        <field name="signal">jlsp_xzbqr</field>
        <field name="group_id" ref="oa_workflow.group_oa_department_boss"/>
    </record>

    <record id="trans_oa_qingjia_xzbqr_ok" model="workflow.transition">
        <field name="act_from" ref="activity_oa_qingjia_xzbqr"/>
        <field name="act_to" ref="activity_oa_qingjia_ok"/>
        <field name="signal">xzbqr_ok</field>
        <field name="group_id" ref="oa_workflow.group_oa_department_xzb"/>
    </record>

    <!--回退流程-->
    <record id="trans_oa_qingjia_jlsp_ldsp" model="workflow.transition">
        <field name="act_from" ref="activity_oa_qingjia_jlsp"/>
        <field name="act_to" ref="activity_oa_qingjia_ldsp"/>
        <field name="signal">jlsp_ldsp</field>
        <field name="condition">not emp_is_cwb_manager()</field>
        <field name="group_id" ref="oa_workflow.group_oa_department_fz"/>
    </record>
    <record id="trans_oa_qingjia_jlsp_ldsp2" model="workflow.transition">
        <field name="act_from" ref="activity_oa_qingjia_jlsp"/>
        <field name="act_to" ref="activity_oa_qingjia_ldsp"/>
        <field name="signal">jlsp_ldsp</field>
        <field name="condition">not emp_is_cwb_manager()</field>
        <field name="group_id" ref="oa_workflow.group_oa_department_boss"/>
    </record>
    <record id="trans_oa_qingjia_jlsp_ldsp3" model="workflow.transition">
        <field name="act_from" ref="activity_oa_qingjia_jlsp"/>
        <field name="act_to" ref="activity_oa_qingjia_sq"/>
        <field name="signal">jlsp_ldsp</field>
        <field name="condition">emp_is_cwb_manager()</field>
        <field name="group_id" ref="oa_workflow.group_oa_department_fz"/>
    </record>
    <record id="trans_oa_qingjia_jlsp_ldsp4" model="workflow.transition">
        <field name="act_from" ref="activity_oa_qingjia_jlsp"/>
        <field name="act_to" ref="activity_oa_qingjia_sq"/>
        <field name="signal">jlsp_ldsp</field>
        <field name="condition">emp_is_cwb_manager()</field>
        <field name="group_id" ref="oa_workflow.group_oa_department_boss"/>
    </record>

    <record id="trans_oa_qingjia_ldsp_sq" model="workflow.transition">
        <field name="act_from" ref="activity_oa_qingjia_ldsp"/>
        <field name="act_to" ref="activity_oa_qingjia_sq"/>
        <field name="signal">ldsp_sq</field>
        <field name="condition">is_ld()</field>
    </record>

</odoo>
