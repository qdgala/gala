<?xml version="1.0"?>
<openerp>
    <data noupdate="0">

        <!--定义工作流-->
        <record id="oa_bangongcg_workflow" model="workflow">
            <field name="name">办公用品申请</field>
            <field name="osv">oa.bangongcg</field>
            <field name="on_create">True</field>
        </record>
        <!--活动（Activity）定义-->
        <record id="activity_oa_bangongcg_sq" model="workflow.activity">
            <field name="wkf_id" ref="oa_bangongcg_workflow"/>
            <field name="flow_start">True</field>
            <field name="name">使用人申请</field>
            <field name="kind">function</field>
            <field name="action">wkf_change_and_notice('sq')</field>
        </record>
        <record id="activity_oa_bangongcg_bm" model="workflow.activity">
            <field name="wkf_id" ref="oa_bangongcg_workflow"/>
            <field name="name">部门领导审批</field>
            <field name="kind">function</field>
            <field name="action">wkf_change_and_notice('bm')</field>
        </record>
        <record id="activity_oa_bangongcg_cw" model="workflow.activity">
            <field name="wkf_id" ref="oa_bangongcg_workflow"/>
            <field name="name">财务部门领导审批</field>
            <field name="kind">function</field>
            <field name="action">wkf_change_and_notice('cw')</field>
        </record>
        <record id="activity_oa_bangongcg_fz" model="workflow.activity">
            <field name="wkf_id" ref="oa_bangongcg_workflow"/>
            <field name="name">副总（或总经理）</field>
            <field name="kind">function</field>
            <field name="action">wkf_change_and_notice('fz')</field>
        </record>
        <record id="activity_oa_bangongcg_cg" model="workflow.activity">
            <field name="wkf_id" ref="oa_bangongcg_workflow"/>
            <field name="name">采购专员确认</field>
            <field name="kind">function</field>
            <field name="action">wkf_change_and_notice('cg')</field>
        </record>
        <record id="activity_oa_bangongcg_ok" model="workflow.activity">
            <field name="wkf_id" ref="oa_bangongcg_workflow"/>
            <field name="flow_stop">True</field>
            <field name="name">完成</field>
            <field name="kind">function</field>
            <field name="action">wkf_change_and_notice('ok')</field>
        </record>
        <record id="activity_oa_bangongcg_off" model="workflow.activity">
            <field name="wkf_id" ref="oa_bangongcg_workflow"/>
            <field name="flow_stop">True</field>
            <field name="name">关闭</field>
            <field name="kind">function</field>
            <field name="action">wkf_change_and_notice('off')</field>
        </record>

        <!--迁移（Transition）的定义-->
        <record id="trans_oa_bangongcg_sq_off" model="workflow.transition">
            <field name="act_from" ref="activity_oa_bangongcg_sq"/>
            <field name="act_to" ref="activity_oa_bangongcg_off"/>
            <field name="signal">sq_off</field>
            <field name="condition">is_user()</field>
        </record>
        <record id="trans_oa_bangongcg_sq_bm" model="workflow.transition">
            <field name="act_from" ref="activity_oa_bangongcg_sq"/>
            <field name="act_to" ref="activity_oa_bangongcg_bm"/>
            <field name="signal">sq_to</field>
            <field name="condition">is_user() and is_not_in(['oa_workflow.group_oa_department_manager','oa_workflow.group_oa_department_fz','oa_workflow.group_oa_department_boss','oa_workflow.group_oa_department_cwb']) and not emp_is_cwb_user()</field>
        </record>
        <record id="trans_oa_bangongcg_sq_cw" model="workflow.transition">
            <field name="act_from" ref="activity_oa_bangongcg_sq"/>
            <field name="act_to" ref="activity_oa_bangongcg_cw"/>
            <field name="signal">sq_to</field>
            <field name="condition">is_user() and is_not_in(['oa_workflow.group_oa_department_fz','oa_workflow.group_oa_department_boss','oa_workflow.group_oa_department_cwb'])  and not emp_is_cwb_user()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_manager"/>
        </record>
        <record id="trans_oa_bangongcg_sq_cw2" model="workflow.transition">
            <field name="act_from" ref="activity_oa_bangongcg_sq"/>
            <field name="act_to" ref="activity_oa_bangongcg_cw"/>
            <field name="signal">sq_to</field>
            <field name="condition">is_user()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_fz"/>
        </record>
        <record id="trans_oa_bangongcg_sq_cw3" model="workflow.transition">
            <field name="act_from" ref="activity_oa_bangongcg_sq"/>
            <field name="act_to" ref="activity_oa_bangongcg_cw"/>
            <field name="signal">sq_to</field>
            <field name="condition">is_user()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_boss"/>
        </record>
        <record id="trans_oa_bangongcg_sq_cw4" model="workflow.transition">
            <field name="act_from" ref="activity_oa_bangongcg_sq"/>
            <field name="act_to" ref="activity_oa_bangongcg_cw"/>
            <field name="signal">sq_to</field>
            <field name="condition">is_user() and emp_is_cwb_user() and not emp_is_cwb_manager()</field>
        </record>
        <record id="trans_oa_bangongcg_sq_fz" model="workflow.transition">
            <field name="act_from" ref="activity_oa_bangongcg_sq"/>
            <field name="act_to" ref="activity_oa_bangongcg_fz"/>
            <field name="signal">sq_to</field>
            <field name="condition">is_user()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_cwb"/>
        </record>

        <record id="trans_oa_bangongcg_bm_cw" model="workflow.transition">
            <field name="act_from" ref="activity_oa_bangongcg_bm"/>
            <field name="act_to" ref="activity_oa_bangongcg_cw"/>
            <field name="signal">bm_cw</field>
            <field name="condition">is_bmld()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_manager"/>
        </record>

        <record id="trans_oa_bangongcg_cw_cg" model="workflow.transition">
            <field name="act_from" ref="activity_oa_bangongcg_cw"/>
            <field name="act_to" ref="activity_oa_bangongcg_cg"/>
            <field name="signal">cw_fz_or_cg</field>
            <field name="condition">plan_amount &lt;= 5000</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_cwb"/>
        </record>

        <record id="trans_oa_bangongcg_cw_fz" model="workflow.transition">
            <field name="act_from" ref="activity_oa_bangongcg_cw"/>
            <field name="act_to" ref="activity_oa_bangongcg_fz"/>
            <field name="signal">cw_fz_or_cg</field>
            <field name="condition">plan_amount &gt; 5000</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_cwb"/>
        </record>

        <record id="trans_oa_bangongcg_fz_cg1" model="workflow.transition">
            <field name="act_from" ref="activity_oa_bangongcg_fz"/>
            <field name="act_to" ref="activity_oa_bangongcg_cg"/>
            <field name="signal">fz_cg</field>
            <field name="condition">is_fz()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_fz"/>
        </record>
        <record id="trans_oa_bangongcg_fz_cg2" model="workflow.transition">
            <field name="act_from" ref="activity_oa_bangongcg_fz"/>
            <field name="act_to" ref="activity_oa_bangongcg_cg"/>
            <field name="signal">fz_cg</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_boss"/>
        </record>

        <record id="trans_oa_bangongcg_cg_ok" model="workflow.transition">
            <field name="act_from" ref="activity_oa_bangongcg_cg"/>
            <field name="act_to" ref="activity_oa_bangongcg_ok"/>
            <field name="signal">cg_ok</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_cgzy"/>
        </record>

        <!--回退流程-->
        <record id="trans_oa_bangongcg_bm_sq" model="workflow.transition">
            <field name="act_from" ref="activity_oa_bangongcg_bm"/>
            <field name="act_to" ref="activity_oa_bangongcg_sq"/>
            <field name="signal">bm_sq</field>
            <field name="condition">is_bmld()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_manager"/>
        </record>

        <record id="trans_oa_bangongcg_cw_sq" model="workflow.transition">
            <field name="act_from" ref="activity_oa_bangongcg_cw"/>
            <field name="act_to" ref="activity_oa_bangongcg_sq"/>
            <field name="signal">cw_back</field>
            <field name="condition">emp_is_cwb_user()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_cwb"/>
        </record>
        <record id="trans_oa_bangongcg_cw_sq2" model="workflow.transition">
            <field name="act_from" ref="activity_oa_bangongcg_cw"/>
            <field name="act_to" ref="activity_oa_bangongcg_sq"/>
            <field name="signal">cw_back</field>
            <field name="condition">emp_is_manager()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_cwb"/>
        </record>
        <record id="trans_oa_bangongcg_cw_bm" model="workflow.transition">
            <field name="act_from" ref="activity_oa_bangongcg_cw"/>
            <field name="act_to" ref="activity_oa_bangongcg_bm"/>
            <field name="signal">cw_back</field>
            <field name="condition">not emp_is_cwb_user() and not emp_is_manager()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_cwb"/>
        </record>

        <record id="trans_oa_bangongcg_fz_cw1" model="workflow.transition">
            <field name="act_from" ref="activity_oa_bangongcg_fz"/>
            <field name="act_to" ref="activity_oa_bangongcg_cw"/>
            <field name="signal">fz_cw</field>
            <field name="condition">is_fz()</field>
            <field name="condition">not emp_is_cwb_manager()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_fz"/>
        </record>
        <record id="trans_oa_bangongcg_fz_cw2" model="workflow.transition">
            <field name="act_from" ref="activity_oa_bangongcg_fz"/>
            <field name="act_to" ref="activity_oa_bangongcg_cw"/>
            <field name="signal">fz_cw</field>
            <field name="condition">not emp_is_cwb_manager()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_boss"/>
        </record>
        <record id="trans_oa_bangongcg_fz_sq" model="workflow.transition">
            <field name="act_from" ref="activity_oa_bangongcg_fz"/>
            <field name="act_to" ref="activity_oa_bangongcg_sq"/>
            <field name="signal">fz_cw</field>
            <field name="condition">emp_is_cwb_manager()</field>
            <field name="group_id" ref="oa_workflow.group_oa_department_boss"/>
        </record>

    </data>
</openerp>